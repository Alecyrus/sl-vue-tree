!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SlVueTree=t():e.SlVueTree=t()}(window,function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var o={name:"sl-vue-tree",props:{value:{type:Array,default:()=>[]},edgeSize:{type:Number,default:3},showBranches:{type:Boolean,default:!1},level:{type:Number,default:0},parentInd:{type:Number},allowMultiselect:{type:Boolean,default:!0}},data:()=>({rootCursorPosition:null,rootDraggingNode:null}),computed:{cursorPosition(){return this.isRoot?this.rootCursorPosition:this.getParent().cursorPosition},draggingNode(){return this.isRoot?this.rootDraggingNode:this.getParent().draggingNode},nodes(){if(this.isRoot){const e=this.copy(this.value);return this.getNodes(e)}return this.getParent().nodes[this.parentInd].children},gaps(){const e=[];let t=this.level-1;for(this.showBranches||t++;t-- >0;)e.push(t);return e},isRoot(){return!this.level}},methods:{setDraggingNode(e){this.isRoot?this.rootDraggingNode=e:this.getParent().setDraggingNode(e)},setCursorPosition(e){this.isRoot?this.rootCursorPosition=e:this.getParent().setCursorPosition(e)},getNodes(e,t=[]){return e.map((r,o)=>{const s=t.concat(o);return this.getNode(s,r,e)})},getNode(e,t=null,r=null){const o=e.slice(-1)[0];return r=r||this.getNodeSiblings(this.value,e),{title:(t=t||r[o]).title,isLeaf:!!t.isLeaf,children:t.children?this.getNodes(t.children,e):[],isExpanded:void 0==t.isExpanded||!!t.isExpanded,isSelected:!!t.isSelected,data:void 0!==t.data?t.data:{},path:e,pathStr:JSON.stringify(e),ind:o,isFirstChild:0==o,isLastChild:o===r.length-1}},emitInput(e){this.getRoot().$emit("input",e)},emitSelect(e,t){this.getRoot().$emit("select",e,t)},emitDrop(e,t,r){this.getRoot().$emit("drop",e,t,r)},emitToggle(e,t){this.getRoot().$emit("toggle",e,t)},onNodeClickHandler(e,t){if(!this.isRoot)return void this.$emit("itemClick",e,t);const r=this.copy(this.value);this.traverse((r,o)=>{r.pathStr===t.pathStr?o.isSelected=!0:e.ctrlKey&&this.allowMultiselect||o.isSelected&&(o.isSelected=!1)},r),this.emitInput(r),this.emitSelect(t,e)},onNodeDragoverHandler(e,t){if(!this.draggingNode)return;const r=e.currentTarget.offsetHeight,o=this.edgeSize,s=e.offsetY;let i;i=t.isLeaf?s>=r/2?"after":"before":s<=o?"before":s>=r-o?"after":"inside",this.setCursorPosition({node:t,placement:i}),this.checkNodeIsParent(this.draggingNode,this.cursorPosition.node)||e.preventDefault()},onNodeDropHandler(e,t){},onNodeDragstartHandler(e,t){this.setDraggingNode(t)},onNodeDragendHandler(e,t){if(!this.isRoot)return void this.getParent().onNodeDragendHandler(e,t);if(this.checkNodeIsParent(this.draggingNode,this.cursorPosition.node))return void this.stopDrag();const r=this.copy(this.value),o=this.getNodeSiblings(r,this.draggingNode.path)[this.draggingNode.ind],s=this.copy(o);o._markToDelete=!0;const i=this.cursorPosition.node,n=this.getNodeSiblings(r,i.path),a=n[i.ind];if("inside"==this.cursorPosition.placement)a.children=a.children||[],a.children.unshift(s);else{const e="before"===this.cursorPosition.placement?i.ind:i.ind+1;n.splice(e,0,s)}this.traverse((e,t,r)=>{if(!t._markToDelete)return!0;const o=e.ind;return r.splice(o,1),!1},r),this.emitInput(r),this.emitDrop(this.draggingNode,this.cursorPosition,e),this.stopDrag()},onToggleHandler(e,t){this.updateNode(t,{isExpanded:!t.isExpanded}),this.emitToggle(t,e),e.stopPropagation()},stopDrag(){this.setDraggingNode(null),this.setCursorPosition(null)},getParent(){return this.$parent},getRoot(){return this.isRoot?this:this.getParent().getRoot()},getNodeSiblings(e,t){return 1===t.length?e:this.getNodeSiblings(e[t[0]].children,t.slice(1))},updateNode(e,t){if(!this.isRoot)return void this.getParent().updateNode(e,t);const r=this.copy(this.value);this.traverse((r,o)=>{r.pathStr===e.pathStr&&Object.assign(o,t)},r),this.emitInput(r)},getSelected(){const e=[];return this.traverse(t=>{t.isSelected&&e.push(t)}),e},traverse(e,t=null,r=[]){t||(t=this.value);let o=!1;const s=[];return t.forEach((i,n)=>{const a=r.concat(n),d=this.getNode(a,i,t);if(o=!1===e(d,i,t),s.push(d),o)return!1;i.children&&(o=!1===this.traverse(e,i.children,a))}),!o&&s},checkNodeIsParent(e,t){const r=t.path;return JSON.stringify(r.slice(0,e.path.length))==e.pathStr},copy:e=>JSON.parse(JSON.stringify(e))}},s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"sl-vue-tree",class:{"sl-vue-tree-root":e.isRoot},on:{dragover:function(e){e.preventDefault()}}},e._l(e.nodes,function(t,o){return r("div",{staticClass:"sl-vue-tree-node",class:{"sl-vue-tree-selected":t.isSelected}},[r("div",{directives:[{name:"show",rawName:"v-show",value:e.cursorPosition&&e.cursorPosition.node.pathStr===t.pathStr&&"before"===e.cursorPosition.placement,expression:"\n        cursorPosition &&\n        cursorPosition.node.pathStr === node.pathStr &&\n        cursorPosition.placement === 'before'\n      "}],staticClass:"sl-vue-tree-cursor sl-vue-tree-cursor_before"}),e._v(" "),r("div",{staticClass:"sl-vue-tree-node-item",class:{"sl-vue-tree-cursor-inside":e.cursorPosition&&"inside"===e.cursorPosition.placement&&e.cursorPosition.node.pathStr===t.pathStr,"sl-vue-tree-node-is-leaf":t.isLeaf,"sl-vue-tree-node-is-folder":!t.isLeaf},attrs:{draggable:"true"},on:{dragover:function(r){return e.onNodeDragoverHandler(r,t)},drop:function(r){return e.onNodeDropHandler(r,t)},dragstart:function(r){return e.onNodeDragstartHandler(r,t)},dragend:function(r){return e.onNodeDragendHandler(r,t)},click:function(r){return e.onNodeClickHandler(r,t)}}},[e._l(e.gaps,function(e){return r("div",{staticClass:"sl-vue-tree-gap"})}),e._v(" "),e.level&&e.showBranches?r("div",{staticClass:"sl-vue-tree-branch"},[e._t("branch",[t.isLastChild?e._e():r("span",[e._v("\n            "+e._s(String.fromCharCode(9500))+e._s(String.fromCharCode(9472))+" \n          ")]),e._v(" "),t.isLastChild?r("span",[e._v("\n            "+e._s(String.fromCharCode(9492))+e._s(String.fromCharCode(9472))+" \n          ")]):e._e()],{node:t})],2):e._e(),e._v(" "),r("div",{staticClass:"sl-vue-tree-title"},[t.isLeaf?e._e():r("span",{staticClass:"sl-vue-tree-toggle",on:{click:function(r){return e.onToggleHandler(r,t)}}},[e._t("toggle",[r("span",[e._v("\n             "+e._s(t.isLeaf?"":t.isExpanded?"-":"+")+"\n            ")])],{node:t})],2),e._v(" "),e._t("title",[e._v(e._s(t.title))],{node:t})],2),e._v(" "),r("div",{staticClass:"sl-vue-tree-sidebar"},[e._t("sidebar",null,{node:t})],2)],2),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.cursorPosition&&e.cursorPosition.node.pathStr===t.pathStr&&"after"===e.cursorPosition.placement,expression:"\n        cursorPosition &&\n        cursorPosition.node.pathStr === node.pathStr &&\n        cursorPosition.placement === 'after'\n      "}],staticClass:"sl-vue-tree-cursor sl-vue-tree-cursor_after"}),e._v(" "),t.children&&t.children.length&&t.isExpanded?r("sl-vue-tree",{attrs:{value:t.children,level:e.level+1,parentInd:o,allowMultiselect:e.allowMultiselect,edgeSize:e.edgeSize,showBranches:e.showBranches},on:{itemClick:function(t,r){return e.onNodeClickHandler(t,r)}},scopedSlots:e._u([{key:"title",fn:function(t){var r=t.node;return[e._t("title",[e._v(e._s(r.title))],{node:r})]}},{key:"toggle",fn:function(t){var o=t.node;return[e._t("toggle",[r("span",[e._v("\n             "+e._s(o.isLeaf?"":o.isExpanded?"-":"+")+"\n          ")])],{node:o})]}},{key:"sidebar",fn:function(t){var r=t.node;return[e._t("sidebar",null,{node:r})]}}])}):e._e()],1)}))};s._withStripped=!0;var i=function(e,t,r,o,s,i,n,a){var d=typeof(e=e||{}).default;"object"!==d&&"function"!==d||(e=e.default);var l,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=r,u._compiled=!0),o&&(u.functional=!0),i&&(u._scopeId=i),n?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(n)},u._ssrRegister=l):s&&(l=a?function(){s.call(this,this.$root.$options.shadowRoot)}:s),l)if(u.functional){u._injectStyles=l;var c=u.render;u.render=function(e,t){return l.call(t),c(e,t)}}else{var h=u.beforeCreate;u.beforeCreate=h?[].concat(h,l):[l]}return{exports:e,options:u}}(o,s,[],!1,null,null,null);i.options.__file="src\\sl-vue-tree.vue";t.default=i.exports}]).default});
//# sourceMappingURL=sl-vue-tree.js.map