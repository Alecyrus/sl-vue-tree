!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SlVueTree=t():e.SlVueTree=t()}(window,function(){return function(e){var t={};function o(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},o.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);var s={name:"sl-vue-tree",props:{value:{type:Array,default:()=>[]},edgeSize:{type:Number,default:3},showBranches:{type:Boolean,default:!1},level:{type:Number,default:0},parentInd:{type:Number},allowMultiselect:{type:Boolean,default:!0},scrollAreaHeight:{type:Number,default:70},maxScrollSpeed:{type:Number,default:20}},data:()=>({rootCursorPosition:null,scrollIntervalId:0,scrollSpeed:0,lastSelectedNode:null,mouseIsDown:!1,isDragging:!1,lastMousePos:{x:0,y:0}}),mounted(){this.isRoot&&document.addEventListener("mouseup",this.onDocumentMouseupHandler)},beforeDestroy(){document.removeEventListener("mouseup",this.onDocumentMouseupHandler)},computed:{cursorPosition(){return this.isRoot?this.rootCursorPosition:this.getParent().cursorPosition},nodes(){if(this.isRoot){const e=this.copy(this.value);return this.getNodes(e)}return this.getParent().nodes[this.parentInd].children},gaps(){const e=[];let t=this.level-1;for(this.showBranches||t++;t-- >0;)e.push(t);return e},isRoot(){return!this.level},selectionSize(){return this.getSelected().length}},methods:{setCursorPosition(e){this.isRoot?this.rootCursorPosition=e:this.getParent().setCursorPosition(e)},getNodes(e,t=[]){return e.map((o,s)=>{const i=t.concat(s);return this.getNode(i,o,e)})},getNode(e,t=null,o=null){const s=e.slice(-1)[0];return o=o||this.getNodeSiblings(this.value,e),{title:(t=t||o[s]).title,isLeaf:!!t.isLeaf,children:t.children?this.getNodes(t.children,e):[],isExpanded:void 0==t.isExpanded||!!t.isExpanded,isSelected:!!t.isSelected,data:void 0!==t.data?t.data:{},path:e,pathStr:JSON.stringify(e),ind:s,isFirstChild:0==s,isLastChild:s===o.length-1}},emitInput(e){this.getRoot().$emit("input",e)},emitSelect(e,t){this.getRoot().$emit("select",e,t)},emitDrop(e,t,o){this.getRoot().$emit("drop",e,t,o)},emitToggle(e,t){this.getRoot().$emit("toggle",e,t)},emitNodeDblclick(e,t){this.getRoot().$emit("nodedblclick",e,t)},emitNodeContextmenu(e,t){this.getRoot().$emit("nodecontextmenu",e,t)},emitNodeclick(e,t){this.getRoot().$emit("nodeclick",e,t)},onNodeClickHandler(e,t){this.isRoot?(this.emitNodeclick(t,e),e.defaultPrevented||this.select(t,e)):this.getRoot().onNodeClickHandler(e,t)},select(e,t=null,o=!1){o=(t&&t.ctrlKey||o)&&this.allowMultiselect;const s=this.copy(this.value),i=this.allowMultiselect&&t.shiftKey&&this.lastSelectedNode,n=[];let r=!1;this.traverse((t,s)=>{i?(t.pathStr!==e.pathStr&&t.pathStr!==this.lastSelectedNode.pathStr||(s.isSelected=!0,r=!r),r&&(s.isSelected=!0)):t.pathStr===e.pathStr?s.isSelected=!0:o||s.isSelected&&(s.isSelected=!1),s.isSelected&&n.push(t)},s),this.lastSelectedNode=e,this.emitInput(s),this.emitSelect(n,t)},onNodeMousemoveHandler(e,t){if(!this.isRoot)return void this.getRoot().onNodeMousemoveHandler(e,t);const o=this.isDragging;this.isDragging=this.mouseIsDown&&(this.lastMousePos.x!==e.clientX||this.lastMousePos.y!==e.clientY);const s=!1===o&&!0===this.isDragging;if(this.lastMousePos={x:e.clientX,y:e.clientY},!this.isDragging)return;s&&!t.isSelected&&this.select(t,e);const i=e.currentTarget.offsetHeight,n=this.edgeSize,r=e.offsetY;let l;l=t.isLeaf?r>=i/2?"after":"before":r<=n?"before":r>=i-n?"after":"inside",this.setCursorPosition({node:t,placement:l});const a=this.getRoot().$el,d=a.getBoundingClientRect(),c=this.$refs.dragInfo;c.style.top=e.clientY-d.top+a.scrollTop+"px",c.style.left=e.clientX-d.left+"px";const u=d.bottom-this.scrollAreaHeight,h=(e.clientY-u)/(d.bottom-u),p=d.top+this.scrollAreaHeight,f=(p-e.clientY)/(p-d.top);h>0?this.startScroll(h):f>0?this.startScroll(-f):this.stopScroll()},onNodeDropHandler(e,t){},onNodeMousedownHandler(e,t){this.isRoot?this.mouseIsDown=!0:this.getRoot().onNodeMousedownHandler(e,t)},startScroll(e){const t=this.getRoot().$el;this.scrollSpeed!==e&&(this.scrollIntervalId&&this.stopScroll(),this.scrollSpeed=e,this.scrollIntervalId=setInterval(()=>{t.scrollTop+=this.maxScrollSpeed*e},20))},stopScroll(){clearInterval(this.scrollIntervalId),this.scrollIntervalId=0,this.scrollSpeed=0},onDocumentMouseupHandler(e){this.isDragging&&this.onNodeMouseupHandler(e)},onNodeMouseupHandler(e,t=null){if(!this.isRoot)return void this.getRoot().onNodeMouseupHandler(e,t);if(this.mouseIsDown=!1,!this.isDragging&&t)return void this.select(t,e);if(!this.cursorPosition)return void this.stopDrag();const o=this.getSelected();for(let e of o){if(e.pathStr==this.cursorPosition.node.pathStr)return void this.stopDrag();if(this.checkNodeIsParent(e,this.cursorPosition.node))return void this.stopDrag()}const s=this.copy(this.value),i=[];for(let e of o){const t=this.getNodeSiblings(s,e.path)[e.ind];i.push(this.copy(t)),t._markToDelete=!0}const n=this.cursorPosition.node,r=this.getNodeSiblings(s,n.path),l=r[n.ind];if("inside"===this.cursorPosition.placement)l.children=l.children||[],l.children.unshift(...i);else{const e="before"===this.cursorPosition.placement?n.ind:n.ind+1;r.splice(e,0,...i)}this.traverse((e,t,o)=>{let s=o.length;for(;s--;)o[s]._markToDelete&&o.splice(s,1)},s),this.lastSelectedNode=null,this.emitInput(s),this.emitDrop(o,this.cursorPosition,e),this.stopDrag()},onToggleHandler(e,t){this.updateNode(t,{isExpanded:!t.isExpanded}),this.emitToggle(t,e),e.stopPropagation()},stopDrag(){this.isDragging=!1,this.mouseIsDown=!1,this.setCursorPosition(null),this.stopScroll()},getParent(){return this.$parent},getRoot(){return this.isRoot?this:this.getParent().getRoot()},getNodeSiblings(e,t){return 1===t.length?e:this.getNodeSiblings(e[t[0]].children,t.slice(1))},updateNode(e,t){if(!this.isRoot)return void this.getParent().updateNode(e,t);const o=this.copy(this.value);this.traverse((o,s)=>{o.pathStr===e.pathStr&&Object.assign(s,t)},o),this.emitInput(o)},getSelected(){const e=[];return this.traverse(t=>{t.isSelected&&e.push(t)}),e},traverse(e,t=null,o=[]){t||(t=this.value);let s=!1;const i=[];return t.forEach((n,r)=>{const l=o.concat(r),a=this.getNode(l,n,t);if(s=!1===e(a,n,t),i.push(a),s)return!1;n.children&&(s=!1===this.traverse(e,n.children,l))}),!s&&i},checkNodeIsParent(e,t){const o=t.path;return JSON.stringify(o.slice(0,e.path.length))==e.pathStr},copy:e=>JSON.parse(JSON.stringify(e))}},i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"sl-vue-tree",class:{"sl-vue-tree-root":e.isRoot}},[e._l(e.nodes,function(t,s){return o("div",{staticClass:"sl-vue-tree-node",class:{"sl-vue-tree-selected":t.isSelected}},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.cursorPosition&&e.cursorPosition.node.pathStr===t.pathStr&&"before"===e.cursorPosition.placement,expression:"\n        cursorPosition &&\n        cursorPosition.node.pathStr === node.pathStr &&\n        cursorPosition.placement === 'before'\n      "}],staticClass:"sl-vue-tree-cursor sl-vue-tree-cursor_before",on:{dragover:function(e){return e.preventDefault()}}}),e._v(" "),o("div",{staticClass:"sl-vue-tree-node-item",class:{"sl-vue-tree-cursor-inside":e.cursorPosition&&"inside"===e.cursorPosition.placement&&e.cursorPosition.node.pathStr===t.pathStr,"sl-vue-tree-node-is-leaf":t.isLeaf,"sl-vue-tree-node-is-folder":!t.isLeaf},on:{mousemove:function(o){return e.onNodeMousemoveHandler(o,t)},drop:function(o){return e.onNodeDropHandler(o,t)},mousedown:function(o){return e.onNodeMousedownHandler(o,t)},mouseup:function(o){return e.onNodeMouseupHandler(o,t)},click:function(o){return e.onNodeClickHandler(o,t)},contextmenu:function(o){return e.emitNodeContextmenu(t,o)},dblclick:function(o){return e.emitNodeDblclick(t,o)},dragleave:function(o){return e.onDragleaveHandler(o,t)}}},[e._l(e.gaps,function(e){return o("div",{staticClass:"sl-vue-tree-gap"})}),e._v(" "),e.level&&e.showBranches?o("div",{staticClass:"sl-vue-tree-branch"},[e._t("branch",[t.isLastChild?e._e():o("span",[e._v("\n            "+e._s(String.fromCharCode(9500))+e._s(String.fromCharCode(9472))+" \n          ")]),e._v(" "),t.isLastChild?o("span",[e._v("\n            "+e._s(String.fromCharCode(9492))+e._s(String.fromCharCode(9472))+" \n          ")]):e._e()],{node:t})],2):e._e(),e._v(" "),o("div",{staticClass:"sl-vue-tree-title"},[t.isLeaf?e._e():o("span",{staticClass:"sl-vue-tree-toggle",on:{click:function(o){return e.onToggleHandler(o,t)}}},[e._t("toggle",[o("span",[e._v("\n             "+e._s(t.isLeaf?"":t.isExpanded?"-":"+")+"\n            ")])],{node:t})],2),e._v(" "),e._t("title",[e._v(e._s(t.title))],{node:t})],2),e._v(" "),o("div",{staticClass:"sl-vue-tree-sidebar"},[e._t("sidebar",null,{node:t})],2)],2),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.cursorPosition&&e.cursorPosition.node.pathStr===t.pathStr&&"after"===e.cursorPosition.placement,expression:"\n        cursorPosition &&\n        cursorPosition.node.pathStr === node.pathStr &&\n        cursorPosition.placement === 'after'\n      "}],staticClass:"sl-vue-tree-cursor sl-vue-tree-cursor_after",on:{dragover:function(e){return e.preventDefault()}}}),e._v(" "),t.children&&t.children.length&&t.isExpanded?o("sl-vue-tree",{attrs:{value:t.children,level:e.level+1,parentInd:s,allowMultiselect:e.allowMultiselect,edgeSize:e.edgeSize,showBranches:e.showBranches},on:{dragover:function(e){return e.preventDefault()}},scopedSlots:e._u([{key:"title",fn:function(t){var o=t.node;return[e._t("title",[e._v(e._s(o.title))],{node:o})]}},{key:"toggle",fn:function(t){var s=t.node;return[e._t("toggle",[o("span",[e._v("\n             "+e._s(s.isLeaf?"":s.isExpanded?"-":"+")+"\n          ")])],{node:s})]}},{key:"sidebar",fn:function(t){var o=t.node;return[e._t("sidebar",null,{node:o})]}}])}):e._e()],1)}),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.isDragging,expression:"isDragging"}],ref:"dragInfo",staticClass:"sl-vue-tree-drag-info"},[e._t("draginfo",[e._v("\n      Items: "+e._s(e.selectionSize)+"\n    ")])],2)],2)};i._withStripped=!0;var n=function(e,t,o,s,i,n,r,l){var a=typeof(e=e||{}).default;"object"!==a&&"function"!==a||(e=e.default);var d,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=o,c._compiled=!0),s&&(c.functional=!0),n&&(c._scopeId=n),r?(d=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},c._ssrRegister=d):i&&(d=l?function(){i.call(this,this.$root.$options.shadowRoot)}:i),d)if(c.functional){c._injectStyles=d;var u=c.render;c.render=function(e,t){return d.call(t),u(e,t)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,d):[d]}return{exports:e,options:c}}(s,i,[],!1,null,null,null);n.options.__file="src\\sl-vue-tree.vue";t.default=n.exports}]).default});
//# sourceMappingURL=sl-vue-tree.js.map